name: Track Benchmark

on:
    push:
      branches: main
    pull_request:
      paths-ignore: ["docs/**", "**.md"]
      types: [opened, reopened, synchronize, labeled]

jobs:
    benchmark_with_bencher:
      name: Continuous Benchmarking with Bencher
      runs-on: ubuntu-latest
      env:
        BENCHER_PROJECT: tailcall
        BENCHER_TESTBED: ubuntu-latest
        BENCHER_ADAPTER: json
      steps:
        - name: Check out code
          uses: actions/checkout@v4
          with:
            ref: ${{ github.event.pull_request.head.sha }}

        - uses: bencherdev/bencher@main
        - name: Track Benchmarks with Bencher
          run: |
            bencher run \
            --branch "$GITHUB_REF_NAME" \
            --token eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhcGlfa2V5IiwiZXhwIjo2MDA1MDIxMDgzLCJpYXQiOjE3MTAwNTM3ODgsImlzcyI6ImJlbmNoZXIuZGV2Iiwic3ViIjoiZGFicmFsYWxhbmtyaXRAZ21haWwuY29tIiwib3JnIjpudWxsfQ.NYbyDLA7aJN6535_YUjIPN1TsMbZc86qxhGKFgkXVkc \
            --adapter json \
            --if-branch feat/added-bencher-dev \
            --testbed localhost \
            --err \
            "bencher mock"
